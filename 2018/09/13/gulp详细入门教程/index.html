<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力中的前端开发工程师"><title>gulp详细入门教程 | 静默如初</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">gulp详细入门教程</h1><a id="logo" href="/.">静默如初</a><p class="description">The Greatness is Achieved through Diligence and Retarded by Laziness.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/category/"><i class="fa fa-th"> 分类</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">gulp详细入门教程</h1><div class="post-meta">Sep 13, 2018<span> | </span><span class="category"><a class="categroyTitle" href="/categories/Web前端/">Web前端</a><i class="fa fa-angle-double-right"></i><a class="categroyTitle" href="/categories/Web前端/构建工具/">构建工具</a><i class="fa fa-angle-double-right"></i></span></div><div class="clear"><div class="toc-article" id="toc"><i class="fa fa-angle-double-left"></i><div class="toc-content"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#安装-gulp-以及其他依赖"><span class="toc-number">1.</span> <span class="toc-text">安装 gulp 以及其他依赖</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#详解-gulp-的-API"><span class="toc-number">2.</span> <span class="toc-text">详解 gulp 的 API</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#gulp-src"><span class="toc-number">2.1.</span> <span class="toc-text">gulp.src()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gulp-dest"><span class="toc-number">2.2.</span> <span class="toc-text">gulp.dest()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gulp-task"><span class="toc-number">2.3.</span> <span class="toc-text">gulp.task()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#gulp-watch"><span class="toc-number">2.4.</span> <span class="toc-text">gulp.watch()</span></a></li></ol></li></ol></div></div></div><div class="post-content"><blockquote>
<p>前言: 每当我比较闲的时候呢, 我们组长就给我安排学习任务了, 这不, 要求我这两天学习一下gulp这个打包工具, 那么顺便就把学习到的知识点记录下来咯! 以便以后复习使用。这里我就引用一段套话吧, 大家看看就好: gulp是前端开发过程中对代码进行构建的工具，是自动化项目的构建利器；她不仅能对网站资源进行优化，而且在开发过程中很多重复的任务能够使用正确的工具自动完成；使用她，我们不仅可以很愉快的编写代码，而且大大提高我们的工作效率。</p>
</blockquote>
<p>&emsp;&emsp;在学习前，先谈谈大致使用 gulp 的步骤，给读者以初步的认识。首先当然是安装nodejs，通过 nodejs 的 npm 全局安装和项目安装 gulp，其次在项目里安装所需要的 gulp 插件，然后新建 gulp 的配置文件<code>gulpfile.js</code>并写好配置信息（定义gulp任务），最后通过命令提示符运行gulp任务即可。</p>
<h3 id="安装-gulp-以及其他依赖"><a href="#安装-gulp-以及其他依赖" class="headerlink" title="安装 gulp 以及其他依赖"></a>安装 gulp 以及其他依赖</h3><ul>
<li><ol>
<li>全局安装 gulp (为了通过它来执行gulp任务)<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行安装命令</span></span><br><span class="line">npm install gulp -g</span><br><span class="line"></span><br><span class="line"><span class="comment">// 查看版本号</span></span><br><span class="line">gulp -v</span><br></pre></td></tr></table></figure>
</li>
</ol>
</li>
<li><ol start="2">
<li>新建 package.json 文件</li>
</ol>
</li>
</ul>
<p>执行命令 <code>npm init</code><br>package.json是基于nodejs项目必不可少的配置文件，它是存放在项目根目录的普通json文件；</p>
<figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  "name": "test",   //项目名称（必须）</span><br><span class="line">  "version": "1.0.0",   //项目版本（必须）</span><br><span class="line">  "description": "This is for study gulp project !",   //项目描述（必须）</span><br><span class="line">  "homepage": "",   //项目主页</span><br><span class="line">  "repository": &#123;    //项目资源库</span><br><span class="line">    "type": "git",</span><br><span class="line">    "url": "https://git.oschina.net/xxxx"</span><br><span class="line">  &#125;,</span><br><span class="line">  "author": &#123;    //项目作者信息</span><br><span class="line">    "name": "surging",</span><br><span class="line">    "email": "surging2@qq.com"</span><br><span class="line">  &#125;,</span><br><span class="line">  "license": "ISC",    //项目许可协议</span><br><span class="line">  "devDependencies": &#123;    //项目依赖的插件</span><br><span class="line">    "gulp": "^3.8.11",</span><br><span class="line">    "gulp-less": "^3.0.0"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li><ol start="3">
<li>本地安装 gulp 以及其他插件</li>
</ol>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 执行安装命令</span></span><br><span class="line">npm install gulp --save-dev</span><br></pre></td></tr></table></figure>
<p><font color="skyblue">细心的你可能会发现，我们全局安装了gulp，项目也安装了gulp，全局安装gulp是为了执行gulp任务，本地安装gulp则是为了调用gulp插件的功能。<font></font></font></p>
<ul>
<li><ol start="4">
<li>新建gulpfile.js文件（重要)<br>说明：gulpfile.js是gulp项目的配置文件，是位于项目根目录的普通js文件（其实将gulpfile.js放入其他文件夹下亦可）</li>
</ol>
</li>
<li><ol start="5">
<li>运行gulp<br>命令提示符执行 <code>gulp 任务名称</code><br>当执行<code>gulp default</code>或<code>gulp将</code>会调用 default 任务里的所有任务</li>
</ol>
</li>
</ul>
<h3 id="详解-gulp-的-API"><a href="#详解-gulp-的-API" class="headerlink" title="详解 gulp 的 API"></a>详解 gulp 的 API</h3><p>&emsp;&emsp;要运行 gulp 任务，只需切换到存放<code>gulpfile.js</code>文件的目录( windows 平台请使用 cmd 或者 Power Shell 等工具)，然后在命令行中执行 gulp 命令就行了，gulp 后面可以加上要执行的任务名，例如 gulp task1，如果没有指定任务名，则会执行任务名为 default 的默认任务。</p>
<p>&emsp;&emsp;使用 gulp，仅需知道 4 个 API 即可：gulp.task(), gulp.src(), gulp.dest(), gulp.watch()，所以很容易就能掌握，但有几个地方需理解透彻才行。往下看…</p>
<h4 id="gulp-src"><a href="#gulp-src" class="headerlink" title="gulp.src()"></a>gulp.src()</h4><p>获取文件流。注意这个流里的内容不是原始的文件流，而是一个虚拟文件对象流(<code>Vinyl files</code>)，这个虚拟文件对象中存储着原始文件的路径、文件名、内容等信息，基本语法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.src([globs], option)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>globs 参数是文件匹配模式(类似正则表达式), 用来匹配文件路径(包括文件名), 当然这里也可直接指定某个具体的文件路径. 当有多个匹配模式时, 该参数可以为一个数组. option 为可选参数, 通常情况下不需要用到.</p>
</blockquote>
<ul>
<li><p>下面重点介绍gulp常用的glob匹配规则和技巧：</p>
<ul>
<li><backcode>*</backcode>匹配文件路径中的0个或多个字符，但不会匹配路径分隔符，除非路径分隔符出现在末尾</li>
<li><backcode>**</backcode> 匹配路径中的0个或多个目录及其子目录,需要单独出现，即它左右不能有其他东西了。如果出现在末尾，也能匹配文件。</li>
<li><backcode>?</backcode> 匹配文件路径中的一个字符(不会匹配路径分隔符)</li>
<li><backcode>[…]</backcode> 匹配方括号中出现的字符中的任意一个，当方括号中第一个字符为^或!时，则表示不匹配方括号中出现的其他字符中的任意一个，类似js正则表达式中的用法</li>
<li><backcode>!(pattern|pattern|pattern)</backcode> 匹配任何与括号中给定的任一模式都不匹配的</li>
<li><backcode>?(pattern|pattern|pattern)</backcode> 匹配括号中给定的任一模式0次或1次，类似于js正则中的 (pattern|pattern|pattern)?</li>
<li><backcode>+(pattern|pattern|pattern)</backcode> 匹配括号中给定的任一模式至少1次，类似于js正则中的(pattern|pattern|pattern)+</li>
<li><backcode> <em> (pattern|pattern|pattern)</em></backcode> 匹配括号中给定的任一模式0次或多次，类似于js正则中的(pattern|pattern|pattern)</li>
<li><backcode>@(pattern|pattern|pattern)</backcode> 匹配括号中给定的任一模式1次，类似于js正则中的(pattern|pattern|pattern)</li>
</ul>
</li>
<li><p>语法看起来太枯燥，我们还是结合实际场景看看：</p>
<ul>
<li><backcode>*</backcode> 能匹配 <backcode>a.js, x.y, abc, abc/</backcode>,但不能匹配<backcode>a/b.js</backcode></li>
<li><backcode><em>.</em></backcode> 能匹配 <backcode>a.js, style.css, a.b,x.y</backcode></li>
<li><backcode><em>/</em>/*.js</backcode> 能匹配 <backcode>a/b/c.js, x/y/z.js</backcode>,不能匹配<backcode>a/b.js, a/b/c/d.js</backcode></li>
<li><backcode>**</backcode> 能匹配 <backcode>abc, a/b.js, a/b/c.js, x/y/z, x/y/z/a.b</backcode>,能用来匹配所有的目录和文件</li>
<li><backcode>*<em>/</em>.js</backcode> 能匹配 <backcode>foo.js, a/foo.js, a/b/foo.js, a/b/c/foo.js</backcode></li>
<li><backcode>a/**/z</backcode> 能匹配 <backcode>a/z, a/b/z, a/b/c/z, a/d/g/h/j/k/z</backcode></li>
<li><backcode>a/<strong>b/z</strong></backcode> 能匹配 <backcode>a/b/z, a/sb/z</backcode>,但不能匹配<backcode>a/x/sb/z</backcode>,因为只有单<backcode></backcode>单独出现才能匹配多级目录</li>
<li><backcode>?.js</backcode> 能匹配 <backcode>a.js, b.js, c.js</backcode></li>
<li><backcode>a??</backcode> 能匹配 <backcode>a.b, abc</backcode>,但不能匹配<backcode>ab/</backcode>,因为它不会匹配路径分隔符</li>
<li><backcode>[xyz].js</backcode> 只能匹配 <backcode>x.js, y.js, z.js</backcode>,不会匹配 <backcode>xy.js, xyz.js</backcode>等,整个中括号只代表一个字符</li>
<li><backcode>[^xyz].js</backcode> 能匹配 <backcode>a.js, b.js, c.js</backcode>等,不能匹配 <backcode>x.js, y.js, z.js</backcode>
</li>
</ul>
</li>
<li><p>当有多种匹配模式时可以使用数组：</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.src([<span class="string">'js/*.js'</span>,<span class="string">'css/*.css'</span>,<span class="string">'*.html'</span>])</span><br></pre></td></tr></table></figure>
<p>使用数组的方式还有一个好处就是可以很方便的使用排除模式，在数组中的单个匹配模式前加上!即是排除模式，它会在匹配的结果中排除这个匹配，要注意一点的是不能在数组中的第一个元素中使用排除模式。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">gulp.src([*.js,<span class="string">'!b*.js'</span>]) <span class="comment">//匹配所有js文件，但排除掉以b开头的js文件</span></span><br><span class="line">gulp.src([<span class="string">'!b*.js'</span>,*.js]) <span class="comment">//不会排除任何文件，因为排除模式不能出现在数组的第一个元素中</span></span><br></pre></td></tr></table></figure>
<p><font color="skyblue">此外，还可以使用展开模式。</font> 展开模式以花括号作为定界符，根据它里面的内容，会展开为多个模式，最后匹配的结果为所有展开的模式相加起来得到的结果。展开的例子如下：</p>
<ul>
<li>a{b,c}d 会展开为 abd, acd</li>
<li>a{b,}c 会展开为 abc, ac</li>
<li>a{0..3}d 会展开为 a0d, a1d, a2d, a3d</li>
<li>a{b,c{d,e}f}g 会展开为 abg, acdfg, acefg</li>
<li>a{b,c}d{e,f}g 会展开为 abdeg, acdeg, abdeg, abdfg</li>
</ul>
<h4 id="gulp-dest"><a href="#gulp-dest" class="headerlink" title="gulp.dest()"></a>gulp.dest()</h4><p>写文件。基本语法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.dest([path],options)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>path为写入文件的路径，options为一个可选的参数对象，通常我们不需要用到。</p>
</blockquote>
<p>gulp的使用流程一般是这样子的：首先通过<code>gulp.src()</code>方法获取到我们想要处理的文件流，然后把文件流通过pipe方法导入到gulp的插件中，最后把经过插件处理后的流再通过<code>pipe</code>方法导入到<code>gulp.dest()</code>中，<code>gulp.dest()</code>方法则把流中的内容写入到文件中，这里首先需要弄清楚的一点是，我们给<code>gulp.dest()</code>传入的路径参数，只能用来指定要生成的文件的目录，而不能指定生成文件的文件名，它生成文件的文件名使用的是导入到它的文件流自身的文件名，所以生成的文件名是由导入到它的文件流决定的，即使我们给它传入一个带有文件名的路径参数，然后它也会把这个文件名当做是目录名，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = <span class="built_in">require</span>(<span class="string">'gulp'</span>);</span><br><span class="line">gulp.src(<span class="string">'script/jquery.js'</span>)</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist/foo.js'</span>));</span><br><span class="line"><span class="comment">//最终生成的文件路径为 dist/foo.js/jquery.js,而不是dist/foo.js</span></span><br></pre></td></tr></table></figure>
<p>要想改变文件名，可以使用插件 <a href="https://www.npmjs.com/package/gulp-rename" target="_blank" rel="noopener">gulp-rename</a></p>
<p>下面说说生成的文件路径与我们给<code>gulp.dest()</code>方法传入的路径参数之间的关系。<br><code>gulp.dest(path)</code> 生成的文件路径是我们传入的<code>path</code>参数后面再加上<code>gulp.src()</code>中有通配符开始出现的那部分路径。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> gulp = reruire(<span class="string">'gulp'</span>);</span><br><span class="line"><span class="comment">//有通配符开始出现的那部分路径为 **/*.js</span></span><br><span class="line">gulp.src(<span class="string">'script/**/*.js'</span>)</span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>)); <span class="comment">//最后生成的文件路径为 dist/**/*.js</span></span><br><span class="line"><span class="comment">//如果 **/*.js 匹配到的文件为 jquery/jquery.js ,则生成的文件路径为 dist/jquery/jquery.js</span></span><br></pre></td></tr></table></figure>
<p>再举更多一点的例子</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">'script/avalon/avalon.js'</span>) <span class="comment">//没有通配符出现的情况</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>)); <span class="comment">//最后生成的文件路径为 dist/avalon.js</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//有通配符开始出现的那部分路径为 **/underscore.js</span></span><br><span class="line">gulp.src(<span class="string">'script/**/underscore.js'</span>)</span><br><span class="line">    <span class="comment">//假设匹配到的文件为script/util/underscore.js</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>)); <span class="comment">//则最后生成的文件路径为 dist/util/underscore.js</span></span><br><span class="line"></span><br><span class="line">gulp.src(<span class="string">'script/*'</span>) <span class="comment">//有通配符出现的那部分路径为 *</span></span><br><span class="line">    <span class="comment">//假设匹配到的文件为script/zepto.js    </span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>)); <span class="comment">//则最后生成的文件路径为 dist/zepto.js</span></span><br></pre></td></tr></table></figure>
<p>通过指定<code>gulp.src()</code>方法配置参数中的<code>base</code>属性，我们可以更灵活的来改变<code>gulp.dest()</code>生成的文件路径。当我们没有在<code>gulp.src()</code>方法中配置base属性时，base的默认值为通配符开始出现之前那部分路径，例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">'app/src/**/*.css'</span>) <span class="comment">//此时base的值为 app/src</span></span><br></pre></td></tr></table></figure>
<p>上面我们说的<code>gulp.dest()</code>所生成的文件路径的规则，其实也可以理解成，用我们给<code>gulp.dest()</code>传入的路径替换掉<code>gulp.src()</code>中的<code>base</code>路径，最终得到生成文件的路径。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(<span class="string">'app/src/**/*.css'</span>) <span class="comment">/*此时base的值为app/src,也就是说它的base路径为app/src*/</span></span><br><span class="line">     <span class="comment">/*设该模式匹配到了文件 app/src/css/normal.css*/</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'dist'</span>)) <span class="comment">/*用dist替换掉base路径，最终得到 dist/css/normal.css*/</span></span><br></pre></td></tr></table></figure>
<p>所以改变<code>base</code>路径后，<code>gulp.dest()</code>生成的文件路径也会改变</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.src(script/lib<span class="comment">/*.js) //没有配置base参数，此时默认的base路径为script/lib</span></span><br><span class="line"><span class="comment">    /*假设匹配到的文件为script/lib/jquery.js*/</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'build'</span>)) <span class="comment">//生成的文件路径为 build/jquery.js</span></span><br><span class="line"></span><br><span class="line">gulp.src(script/lib<span class="comment">/*.js, &#123;base:'script'&#125;) //配置了base参数，此时base路径为script</span></span><br><span class="line"><span class="comment">    /*假设匹配到的文件为script/lib/jquery.js*/</span></span><br><span class="line">    .pipe(gulp.dest(<span class="string">'build'</span>)) <span class="comment">//此时生成的文件路径为 build/lib/jquery.js</span></span><br></pre></td></tr></table></figure>
<p>用<code>gulp.dest()</code>把文件流写入文件后，文件流仍然可以继续使用。</p>
<h4 id="gulp-task"><a href="#gulp-task" class="headerlink" title="gulp.task()"></a>gulp.task()</h4><p><code>gulp.task</code>方法用来定义任务，内部使用的是<code>Orchestrator</code>，其语法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.task([name],[deps], fn)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>name 为任务名。deps 是当前定义的任务需要依赖的其他任务，为一个数组。当前定义的任务会在所有依赖的任务执行完毕后才开始执行。如果没有依赖，则可省略这个参数。fn 为任务函数，我们把任务要执行的代码都写在里面。该参数也是可选的。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'mytask'</span>, [<span class="string">'array'</span>, <span class="string">'of'</span>, <span class="string">'task'</span>, <span class="string">'names'</span>], <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; <span class="comment">//定义一个有依赖的任务</span></span><br><span class="line">  <span class="comment">// Do something</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>gulp.task()</code>这个API没什么好讲的，但需要知道执行多个任务时怎么来控制任务执行的顺序。<br>gulp中执行多个任务，可以通过任务依赖来实现。例如我想要执行one,two,three这三个任务，那我们就可以定义一个空的任务，然后把那三个任务当做这个空的任务的依赖就行了：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//只要执行default任务，就相当于把one,two,three这三个任务执行了</span></span><br><span class="line">gulp.task(<span class="string">'default'</span>,[<span class="string">'one'</span>,<span class="string">'two'</span>,<span class="string">'three'</span>]);</span><br></pre></td></tr></table></figure>
<p>如果任务相互之间没有依赖，任务会按你书写的顺序来执行，如果有依赖的话则会先执行依赖的任务。但是如果某个任务所依赖的任务是异步的，就要注意了，gulp并不会等待那个所依赖的异步任务完成，而是会接着执行后续的任务。例如：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//one是一个异步执行的任务</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'one is done'</span>)</span><br><span class="line">  &#125;,<span class="number">5000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//two任务虽然依赖于one任务,但并不会等到one任务中的异步操作完成后再执行</span></span><br><span class="line">gulp.task(<span class="string">'two'</span>,[<span class="string">'one'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'two is done'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>上面的例子中我们执行two任务时，会先执行one任务，但不会去等待one任务中的异步操作完成后再执行two任务，而是紧接着执行two任务。所以two任务会在one任务中的异步操作完成之前就执行了。</p>
<p>那如果我们想等待异步任务中的异步操作完成后再执行后续的任务，该怎么做呢？有三种方法可以实现:</p>
<p><em>第一: 在异步操作完成后执行一个回调函数来通知gulp这个异步任务已经完成,这个回调函数就是任务函数的第一个参数。</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123; <span class="comment">//cb为任务函数提供的回调，用来通知任务已经完成</span></span><br><span class="line">  <span class="comment">//one是一个异步执行的任务</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'one is done'</span>);</span><br><span class="line">    cb();  <span class="comment">//执行回调，表示这个异步任务已经完成</span></span><br><span class="line">  &#125;,<span class="number">5000</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">//这时two任务会在one任务中的异步操作完成后再执行</span></span><br><span class="line">gulp.task(<span class="string">'two'</span>,[<span class="string">'one'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'two is done'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>第二：定义任务时返回一个流对象。适用于任务就是操作gulp.src获取到的流的情况。(常用)</em></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">  var stream = gulp.src(&apos;client/**/*.js&apos;)</span><br><span class="line">      .pipe(dosomething()) //dosomething()中有某些异步操作</span><br><span class="line">      .pipe(gulp.dest(&apos;build&apos;));</span><br><span class="line">    return stream;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(&apos;two&apos;,[&apos;one&apos;],function()&#123;</span><br><span class="line">  console.log(&apos;two is done&apos;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><em>第三：返回一个promise对象</em></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Q = <span class="built_in">require</span>(<span class="string">'q'</span>); <span class="comment">//一个著名的异步处理的库 https://github.com/kriskowal/q</span></span><br><span class="line">gulp.task(<span class="string">'one'</span>,<span class="function"><span class="keyword">function</span>(<span class="params">cb</span>)</span>&#123;</span><br><span class="line">  <span class="keyword">var</span> deferred = Q.defer();</span><br><span class="line">  <span class="comment">// 做一些异步操作</span></span><br><span class="line">  setTimeout(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">     deferred.resolve();</span><br><span class="line">  &#125;, <span class="number">5000</span>);</span><br><span class="line">  <span class="keyword">return</span> deferred.promise;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">gulp.task(<span class="string">'two'</span>,[<span class="string">'one'</span>],<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'two is done'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p><code>gulp.task()</code>就这些了，主要是要知道当依赖是异步任务时的处理。</p>
<h4 id="gulp-watch"><a href="#gulp-watch" class="headerlink" title="gulp.watch()"></a>gulp.watch()</h4><p>监视文件的变化，当文件发生变化后，我们可以利用它来执行相应的任务，例如文件压缩等。其语法为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.watch([glob], [opts], [tasks])</span><br></pre></td></tr></table></figure>
<blockquote>
<p>glob 为要监视的文件匹配模式，规则和用法与gulp.src()方法中的glob相同。opts 为一个可选的配置对象，通常不需要用到。tasks 为文件变化后要执行的任务，为一个数组。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">gulp.task(<span class="string">'uglify'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//do something</span></span><br><span class="line">&#125;);</span><br><span class="line">gulp.task(<span class="string">'reload'</span>,<span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">  <span class="comment">//do something</span></span><br><span class="line">&#125;);</span><br><span class="line">gulp.watch(<span class="string">'js/**/*.js'</span>, [<span class="string">'uglify'</span>,<span class="string">'reload'</span>]);</span><br></pre></td></tr></table></figure>
<p>gulp.watch() 还有另外一种使用方式：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">gulp.watch([glob], [opts], cb)</span><br></pre></td></tr></table></figure>
<blockquote>
<p>glob和opts参数与第一种用法相同。cb参数为一个函数。每当监视的文件发生变化时，就会调用这个函数,并且会给它传入一个对象，该对象包含了文件变化的一些信息，type属性为变化的类型，可以是<code>added,changed,deleted；path</code>属性为发生变化的文件的路径。</p>
</blockquote>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">gulp.watch(<span class="string">'js/**/*.js'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">event</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(event.type); <span class="comment">//变化类型 added为新增,deleted为删除，changed为改变 </span></span><br><span class="line">    <span class="built_in">console</span>.log(event.path); <span class="comment">//变化的文件的路径</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a class="article-share-link" data-url="http://www.luo01.cn/2018/09/13/gulp详细入门教程/" data-id="cjmnl0caj002huouy8v7lzpw1" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAMYAAADGCAAAAACs8KCBAAACPElEQVR42u3aS47CMBBFUfa/aVrqUUu0nfuqACnl6xECkvhkYNXv8cDr+btev/m7Vr++3mF17epub1syZMi4LeO5XatNrJD7zZFN769dUmXIkHEAY3/I7mFkuwRJXtnyexkyZMio3Xobv8mQIUPG5w5c8sg0QZUhQ4YMwiBJbOc/5EV8KReXIUPGDRlpY+Cbnz/Y35AhQ8ZNGJ0jkpTb0oJdcVcyZMgYzSDBWWeE4l1JLDqOZciQMZTRL36ljLSIRgYyZMiQcQ6DHLspiRygtSboo7YtGTJk3JBRG4zoj1bU/rNvpsqQIWMqo3b81dqW+4IaP1L/AcuQIeMYBhmeICNffHOdIQwZMmScw/jOkATf6NtamDJkyBjHqAV5aZszRfLBDhkyZJzD4H9CB18pZEybDTJkyDiBkaajta302wAXr1iGDBmjGZ1RhrSsnxbvauMgMmTImM3gjUaS1vIEuNZIkCFDxmkMflM+fsFLb7VAEPU3ZMiQMYiRPjINH9MQs5Uqy5AhYxyjNpLVGQJLWwvo1ciQIeMARnpZLfirpbhonzJkyBjN6NTnSAGOhIO1qy7KbTJkyBjEeIYr6DPgMhxvSCx/lSFDxmgGX+kwBC/S8bJaJ/WVIUPG3Rn8kOWPT8c10mGOIN6UIUPGIAY5ZHk4yLfeaQlc5OIyZMg4kkFmN8gW0zuglyhDhgwZ22OxVpJLj9qLxFiGDBkHMNLEshPe8Wt5kU6GDBmzGbUEkgd5aXCZpsQyZMgYzfgBzKFgvjA6UoIAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/web-自动化-构建工具/">web 自动化 构建工具</a></div><div class="post-nav"><a class="pre" href="/2018/09/15/gulp常用插件/">gulp常用插件</a><a class="next" href="/2018/09/08/小程序如何引入fontAwesome/">小程序如何引入fontAwesome</a></div></div><script type="text/javascript" src="/js/artical.js?v=0.0.1"></script></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><a href="http://luo01.cn/"><img class="protrait" src="http://luo01.cn/img/protrait.png" alt=""/></a></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/">Web前端</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Javascript/">Javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Vue/">Vue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/小程序/">小程序</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/构建工具/">构建工具</a><span class="category-list-count">2</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Async-Await-Js/" style="font-size: 15px;">Async/Await Js</a> <a href="/tags/设计模式-Js/" style="font-size: 15px;">设计模式 Js</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/web-小程序/" style="font-size: 15px;">web 小程序</a> <a href="/tags/web-自动化-构建工具/" style="font-size: 15px;">web 自动化 构建工具</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/小程序swiper-bindChange重复执行/">小程序swiper bindChange重复执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/15/gulp常用插件/">gulp常用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/gulp详细入门教程/">gulp详细入门教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序如何引入fontAwesome/">小程序如何引入fontAwesome</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序实现左滑删除功能/">小程序实现左滑删除功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序封装滚动Tab选项卡-可滑动/">小程序封装滚动Tab选项卡: 可滑动</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序出现【需要身份验证】弹窗解决办法/">小程序出现【需要身份验证】弹窗解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/24/Github如何进行PR(Pull Request)的操作/">Github如何进行PR(Pull Request)操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/06/小程序简易开发/">微信小程序简易开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/Javascript 设计模式(二)/">Javascript 设计模式(二) --- 构造器模式与模块模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul class="post-list"> <li class="post-list-item"> <a class="post-list-link" href="http://www.ruanyifeng.com" title="阮一峰" target="_blank">阮一峰</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.zhangxinxu.com/wordpress/" title="张鑫旭" target="_blank">张鑫旭</a></li><li class="post-list-item"> <a class="post-list-link" href="https://coolshell.cn/featured" title="左耳朵耗子" target="_blank">左耳朵耗子</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.giscafer.com/" title="Nickbing Lao" target="_blank">Nickbing Lao</a></li><li class="post-list-item"> <a class="post-list-link" href="https://ioliu.cn/" title="云淡风轻" target="_blank">云淡风轻</a></li><li class="post-list-item"> <a class="post-list-link" href="https://www.haomwei.com/" title="紫禁屠夫" target="_blank">紫禁屠夫</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">静默如初.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>