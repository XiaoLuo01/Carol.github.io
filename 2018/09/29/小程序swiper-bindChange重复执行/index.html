<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力中的前端开发工程师"><title>小程序swiper bindChange重复执行 | 静默如初</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">小程序swiper bindChange重复执行</h1><a id="logo" href="/.">静默如初</a><p class="description">The Greatness is Achieved through Diligence and Retarded by Laziness.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/category/"><i class="fa fa-th"> 分类</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">小程序swiper bindChange重复执行</h1><div class="post-meta">Sep 29, 2018<span> | </span><span class="category"><a class="categroyTitle" href="/categories/Web前端/">Web前端</a><i class="fa fa-angle-double-right"></i><a class="categroyTitle" href="/categories/Web前端/小程序/">小程序</a><i class="fa fa-angle-double-right"></i></span></div><div class="clear"><div class="toc-article" id="toc"><i class="fa fa-angle-double-left"></i><div class="toc-content"><div class="toc-title">文章目录</div></div></div></div><div class="post-content"><blockquote>
<p>问题：在上一篇文章中写到了自己封装的一个tabBar的组件，以实现能够左右滑动的功能，我使用的是就是小程序里面自带的 swiper 组件来实现。但是经过测试发现了一个问题：当进入页面快速快速的滑动几次就会开始闪烁，页面自己就不停的左右滑动。</p>
</blockquote>
<p>进行真机调试的时候， 通过控制台打印可以发现是 <code>bindChange</code> 绑定的方法重复执行了, 这时候我找到了官方文档的解释 <a href="https://developers.weixin.qq.com/miniprogram/dev/component/swiper.html" target="_blank" rel="noopener">跳转官方文档</a></p>
<p><img src="/2018/09/29/小程序swiper-bindChange重复执行/swiper_01.png" alt="swiper_01"></p>
<p>这时候可以发现, 我确实是在 <code>bindChange</code> 绑定的方法里面使用了 <code>setData()</code> 这个方法, 来保证swiper组件的 current 属性与我们的 this.data.activeIndex 保持同步.</p>
<p>为什么要有 <code>this.data.activeIndex</code> 这个变量？是因为我们要获得当前的页数进行其他的操作。比如底部的 tab 就用到这个变量。但是这个变量必须在 bindChange 进行同步。</p>
<p>至此，我们的程序在快速滑动的时候是有问题的。不断触发setData()。此外，在官方的开发社区找到这么一条：</p>
<p><img src="/2018/09/29/小程序swiper-bindChange重复执行/swiper_02.png" alt="swiper_02"></p>
<p>后来一想，在<code>bindChange</code>改变 swiper 的 current 是有问题的，那么，改变另外的变量呢？答案是没有问题的。</p>
<p>那么，解决办法就是在 data 里定义2个变量：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 组件的初始数据</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">data: &#123;</span><br><span class="line">cur: <span class="number">0</span>, <span class="comment">//改变当前索引</span></span><br><span class="line">activeIndex: <span class="number">0</span> <span class="comment">//当前的索引</span></span><br><span class="line">&#125;,</span><br></pre></td></tr></table></figure>
<p>当前的页数用 activeIndex 来标记。swiper组件的current属性我们用变量cur。互不干扰。</p>
<p>当页面变化时，我们设置 activeIndex, 当我们需要改变页面时，我们设置cur</p>
<p>所以我将之前的代码做了一些修改, 问题就解决啦~~~~</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"tabview"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"tabs &#123;&#123;position == 'top'?'top':'bottom'&#125;&#125;"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">block</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;tabs&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"index"</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">"tab-son &#123;&#123;activeIndex ==index?'active':''&#125;&#125;"</span> <span class="attr">data-index</span>=<span class="string">"&#123;&#123;index&#125;&#125;"</span> <span class="attr">bindtap</span>=<span class="string">'toggleTab'</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">image</span> <span class="attr">class</span>=<span class="string">'tab-icon'</span> <span class="attr">src</span>=<span class="string">'&#123;&#123;activeIndex ==index?item.selectedIcon:item.icon&#125;&#125;'</span> <span class="attr">mode</span>=<span class="string">'aspectFit'</span>&gt;</span><span class="tag">&lt;/<span class="name">image</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">view</span> <span class="attr">class</span>=<span class="string">'tab-text'</span>&gt;</span>&#123;&#123;item.name&#125;&#125;<span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">block</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">swiper</span> <span class="attr">current</span>=<span class="string">"&#123;&#123;cur&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"tab-swiper &#123;&#123;position == 'top'?'padding-top':'padding-bottom'&#125;&#125;"</span> <span class="attr">bindchange</span>=<span class="string">"swiperChange"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">swiper-item</span> <span class="attr">wx:for</span>=<span class="string">"&#123;&#123;tabs&#125;&#125;"</span> <span class="attr">wx:key</span>=<span class="string">"&#123;&#123;index&#125;&#125;"</span> <span class="attr">class</span>=<span class="string">"tab-contents"</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">slot</span> <span class="attr">name</span>=<span class="string">"&#123;&#123;index&#125;&#125;"</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">swiper-item</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">swiper</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">view</span>&gt;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 组件的方法列表</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">methods: &#123;</span><br><span class="line">toggleTab: <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> index = e.currentTarget.dataset.index</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.data.activeIndex === index) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">        activeIndex: index,</span><br><span class="line">        cur: index</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> myEventOption = &#123; <span class="attr">activeIndex</span>: index &#125; <span class="comment">// 触发事件的选项</span></span><br><span class="line">    <span class="keyword">this</span>.triggerEvent(<span class="string">'myevent'</span>, myEventOption)</span><br><span class="line">&#125;,</span><br><span class="line">swiperChange: <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> activeIndex = e.detail.current</span><br><span class="line">    <span class="keyword">this</span>.setData(&#123;</span><br><span class="line">    activeIndex</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">var</span> myEventOption = &#123; activeIndex &#125; <span class="comment">// 触发事件的选项</span></span><br><span class="line">    <span class="keyword">this</span>.triggerEvent(<span class="string">'myevent'</span>, myEventOption)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a class="article-share-link" data-url="http://www.luo01.cn/2018/09/29/小程序swiper-bindChange重复执行/" data-id="cjmnl0c3w000cuouyswh7nrus" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAN4AAADeCAAAAAB3DOFrAAACtklEQVR42u3a0W7jMAwEwPz/T7fAvV6T7JISmgLjp8JwLY0MSAzJxyO+vv5dyTP/P/n6fvv+x40LDw8PbzT1Z1cylYTUYl7zkjnj4eHh3eYlr0t47QI9nVY8nzcWPDw8vF/lJdNq77dRMR4eHt7f4r3e+vNF2Y+Fh4eH9wm8JBmRBNb55DZh9JVcCx4eHl7Mm6VQf/fvi/U9PDw8vEVVPblOFfjzTb+YGx4eHt4F3izBOgtzT7VY1W/Dw8PDu8bbFJ9mjQJJ89b+A+Dh4eHd4CWb/v5OMvU8cZwvGR4eHt5Z3ia0bVsB8iaDY6E5Hh4e3jVem5DNh8ybCWaHxCqBi4eHhzfi5dt0C87D9GRZ82PmTWcZHh4e3pqXbMGzMtgsBXys6JWcJ3h4eHgjXh7ItsMnIXieMs5hT088PDw8vEO8WVE/Hzg5BjYpjwMJCDw8PLxRu8CsfapNDbTLtwnZ33xPPDw8vAVvs+Fu0rVtSmK2KHh4eHj3eO1WPkv75ongWeMCHh4e3ufw8sFObfRJE1jROoCHh4d3gTebShtkJ/c3AfcPd/Dw8PCu8WaB7Kzo1bYatM1eT0NqPDw8vEO8FtDW1jaM9pk3Rw4eHh7eId4sXTtL725C8zbUjn4x4OHh4Y14eWFpFkDnYXGbMq4PGzw8PLxrvLYZa5Zgbf+rfcNjtqJ4eHh4Ma8tR83Sqe1itYdWkavGw8PDO8SbJSPOtl61h0T0MfDw8PCO8r7Kq93i9+F7/hmKLDUeHh7egrc5T2YJ3E1CNjlCahgeHh7eiDcrfSWvbothswLYm9ni4eHhXeO1idpZK0C+oR/IsuDh4eF9GG9W4J+1cLWHBB4eHt7n8JIgO2/P2hfVivoeHh4e3gVeO9isuWrWTDDMPePh4eFd47U/9TfHQ8JIxjq8EHh4eHgp7xuNAMU6efEl3AAAAABJRU5ErkJggg==">分享</a><div class="tags"><a href="/tags/web-小程序/">web 小程序</a></div><div class="post-nav"><a class="next" href="/2018/09/15/gulp常用插件/">gulp常用插件</a></div></div><script type="text/javascript" src="/js/artical.js?v=0.0.1"></script></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><a href="http://luo01.cn/"><img class="protrait" src="http://luo01.cn/img/protrait.png" alt=""/></a></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/">Web前端</a><span class="category-list-count">15</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Javascript/">Javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Vue/">Vue</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/小程序/">小程序</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/构建工具/">构建工具</a><span class="category-list-count">2</span></li></ul></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Async-Await-Js/" style="font-size: 15px;">Async/Await Js</a> <a href="/tags/设计模式-Js/" style="font-size: 15px;">设计模式 Js</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/web-小程序/" style="font-size: 15px;">web 小程序</a> <a href="/tags/web-自动化-构建工具/" style="font-size: 15px;">web 自动化 构建工具</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/小程序swiper-bindChange重复执行/">小程序swiper bindChange重复执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/15/gulp常用插件/">gulp常用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/gulp详细入门教程/">gulp详细入门教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序如何引入fontAwesome/">小程序如何引入fontAwesome</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序实现左滑删除功能/">小程序实现左滑删除功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序封装滚动Tab选项卡-可滑动/">小程序封装滚动Tab选项卡: 可滑动</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序出现【需要身份验证】弹窗解决办法/">小程序出现【需要身份验证】弹窗解决办法</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/24/Github如何进行PR(Pull Request)的操作/">Github如何进行PR(Pull Request)操作</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/07/06/小程序简易开发/">微信小程序简易开发</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/06/20/Javascript 设计模式(二)/">Javascript 设计模式(二) --- 构造器模式与模块模式</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul class="post-list"> <li class="post-list-item"> <a class="post-list-link" href="http://www.ruanyifeng.com" title="阮一峰" target="_blank">阮一峰</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.zhangxinxu.com/wordpress/" title="张鑫旭" target="_blank">张鑫旭</a></li><li class="post-list-item"> <a class="post-list-link" href="https://coolshell.cn/featured" title="左耳朵耗子" target="_blank">左耳朵耗子</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.giscafer.com/" title="Nickbing Lao" target="_blank">Nickbing Lao</a></li><li class="post-list-item"> <a class="post-list-link" href="https://ioliu.cn/" title="云淡风轻" target="_blank">云淡风轻</a></li><li class="post-list-item"> <a class="post-list-link" href="https://www.haomwei.com/" title="紫禁屠夫" target="_blank">紫禁屠夫</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2018 <a href="/." rel="nofollow">静默如初.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>