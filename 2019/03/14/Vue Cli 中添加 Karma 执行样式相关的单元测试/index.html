<!DOCTYPE html><html lang="zh-CN"><head><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description" content="努力中的前端开发工程师"><title>Vue Cli 中添加 Karma 执行样式相关的单元测试 | 静默如初</title><link rel="stylesheet" type="text/css" href="/css/style.css?v=0.0.1"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/normalize/8.0.0/normalize.min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/pure-min.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/pure/1.0.0/grids-responsive-min.css"><link rel="stylesheet" href="//cdn.bootcss.com/font-awesome/4.7.0/css/font-awesome.min.css"><script type="text/javascript" src="//cdn.bootcss.com/jquery/3.3.1/jquery.min.js"></script><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"><link rel="apple-touch-icon" href="/apple-touch-icon.png"><link rel="apple-touch-icon-precomposed" href="/apple-touch-icon.png"></head><body><div class="body_container"><div id="header"><div class="site-name"><h1 class="hidden">Vue Cli 中添加 Karma 执行样式相关的单元测试</h1><a id="logo" href="/.">静默如初</a><p class="description">The Greatness is Achieved through Diligence and Retarded by Laziness.</p></div><div id="nav-menu"><a class="current" href="/."><i class="fa fa-home"> 首页</i></a><a href="/archives/"><i class="fa fa-archive"> 归档</i></a><a href="/category/"><i class="fa fa-th"> 分类</i></a><a href="/about/"><i class="fa fa-user"> 关于</i></a></div></div><div class="pure-g" id="layout"><div class="pure-u-1 pure-u-md-3-4"><div class="content_container"><div class="post"><h1 class="post-title">Vue Cli 中添加 Karma 执行样式相关的单元测试</h1><div class="post-meta">Mar 14, 2019<span> | </span><span class="category"><a class="categroyTitle" href="/categories/Web前端/">Web前端</a><i class="fa fa-angle-double-right"></i><a class="categroyTitle" href="/categories/Web前端/Vue/">Vue</a><i class="fa fa-angle-double-right"></i></span></div><div class="clear"><div class="toc-article" id="toc"><i class="fa fa-angle-double-left"></i><div class="toc-content"><div class="toc-title">文章目录</div><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#出现的问题"><span class="toc-number">1.</span> <span class="toc-text">出现的问题</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#解决方案"><span class="toc-number">2.</span> <span class="toc-text">解决方案</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#配置-package-json"><span class="toc-number">2.1.</span> <span class="toc-text">配置 package.json</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#安装依赖"><span class="toc-number">2.2.</span> <span class="toc-text">安装依赖</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#创建-karma-conf-js"><span class="toc-number">2.3.</span> <span class="toc-text">创建 karma.conf.js</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#总结"><span class="toc-number">3.</span> <span class="toc-text">总结</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#Vue-Cli-3-自带测试框架"><span class="toc-number">3.1.</span> <span class="toc-text">Vue Cli 3 自带测试框架</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#karma-测试运行器"><span class="toc-number">3.2.</span> <span class="toc-text">karma 测试运行器</span></a></li></ol></li></ol></div></div></div><div class="post-content"><blockquote>
<p>在最近开发的 ant-violet 开源项目中，使用的是 Vue-cli 自带的测试框架。但是发现在所有跟样式有关的测试用例都无法通过。因为它并不类似于无头浏览器，而是存在于虚拟内存之中。</p>
</blockquote>
<h3 id="出现的问题"><a href="#出现的问题" class="headerlink" title="出现的问题"></a>出现的问题</h3><p>在如下 <code>button.spec.js</code> 单元测试用例当中，关于 <code>icon 默认的 order</code> 的测试用例无法进行测试，因为它涉及到了样式。前面已经提到由于它处于虚拟内存之中。因此只要进行单元测试，就会出现以下报错。</p>
<p><img src="/2019/03/14/Vue Cli 中添加 Karma 执行样式相关的单元测试/2.png" alt=""></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// button里面的icon样式相关的测试用例</span></span><br><span class="line">it(<span class="string">'icon 默认的 order 是 1'</span>, () =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> wrapper = mount(Button, &#123;</span><br><span class="line">      attachToDocument: <span class="literal">true</span>,</span><br><span class="line">      propsData: &#123;</span><br><span class="line">        icon: <span class="string">'settings'</span>,</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    <span class="keyword">const</span> vm = wrapper.vm</span><br><span class="line">    <span class="keyword">const</span> icon = vm.$el.querySelector(<span class="string">'svg'</span>)</span><br><span class="line">    expect(getComputedStyle(icon).order).to.eq(<span class="string">'1'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<h3 id="解决方案"><a href="#解决方案" class="headerlink" title="解决方案"></a>解决方案</h3><p>使用 <code>Karma</code> 打开浏览器进行测试。</p>
<h4 id="配置-package-json"><a href="#配置-package-json" class="headerlink" title="配置 package.json"></a>配置 <code>package.json</code></h4><p>在 <code>package.json</code> 中添加依赖 <code>Karma</code> 相关的配置，如下图。</p>
<p><img src="/2019/03/14/Vue Cli 中添加 Karma 执行样式相关的单元测试/1.png" alt=""></p>
<h4 id="安装依赖"><a href="#安装依赖" class="headerlink" title="安装依赖"></a>安装依赖</h4><p>使用如下命令安装之前 <code>package.json</code> 中添加的依赖。</p>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">yarn <span class="keyword">add</span><span class="bash"> -D karma karma-chrome-launcher karma-mocha karma-sourcemap-loader karma-spec-reporter karma-webpack</span></span><br></pre></td></tr></table></figure>
<h4 id="创建-karma-conf-js"><a href="#创建-karma-conf-js" class="headerlink" title="创建 karma.conf.js"></a>创建 <code>karma.conf.js</code></h4><p>在 <code>Vue Cli 3</code> 的官方文档  <a href="https://cli.vuejs.org/zh/guide/webpack.html#%E5%AE%A1%E6%9F%A5%E9%A1%B9%E7%9B%AE%E7%9A%84-webpack-%E9%85%8D%E7%BD%AE" target="_blank" rel="noopener">webpack 相关</a> 章节中，可以查询到 <code>Vue Cli 3</code> 将 <code>webpack.config.js</code> 藏到了一个地方，即 <code>/node_modules/@vue/cli-service/webpack.config.js</code>。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> webpackConfig = <span class="built_in">require</span>(<span class="string">"@vue/cli-service/webpack.config.js"</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">module</span>.exports = <span class="function"><span class="keyword">function</span>(<span class="params">config</span>) </span>&#123;</span><br><span class="line">  config.set(&#123;</span><br><span class="line">    frameworks: [<span class="string">"mocha"</span>],</span><br><span class="line">    files: [<span class="string">"tests/**/*.spec.js"</span>],</span><br><span class="line">    preprocessors: &#123;</span><br><span class="line">      <span class="string">"**/*.spec.js"</span>: [<span class="string">"webpack"</span>, <span class="string">"sourcemap"</span>]</span><br><span class="line">    &#125;,</span><br><span class="line">    webpack: webpackConfig,</span><br><span class="line">    reporters: [<span class="string">"spec"</span>],</span><br><span class="line">    browsers: [<span class="string">"ChromeHeadless"</span>]</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><h4 id="Vue-Cli-3-自带测试框架"><a href="#Vue-Cli-3-自带测试框架" class="headerlink" title="Vue Cli 3 自带测试框架"></a>Vue Cli 3 自带测试框架</h4><p>无法运行和样式相关的测试用例。因为它并不类似于无头浏览器，而是存在于虚拟内存之中。<br>这些和样式挂钩的测试用例属性，会被认为是 <code>undefined</code>，因为对于 <code>Vue Cli 3</code> 自带测试框架而言，这些属性本身就是不存在的。因此无法进行测试。</p>
<h4 id="karma-测试运行器"><a href="#karma-测试运行器" class="headerlink" title="karma 测试运行器"></a>karma 测试运行器</h4><p>使用 <code>karma</code> 测试运行器之后，关于样式相关的测试用例可以正常进行运行。但也必须要添加 <code>attachToDocument: true</code>, 属性将元素放置到 <code>DOM</code> 之中。</p>
<p>由于组件的样式相关属性也有单元测试的必要，所以我决定将 <code>karma</code> 测试运行器作为我的默认单元测试框架，因此还需要在 <code>package.json</code> 中设置 <code>&quot;test&quot;: &quot;karma start --single-run&quot;</code>,。以便 <code>travis-ci</code> 进行线上持续集成。</p>
</div><script type="text/javascript" src="/js/share.js?v=0.0.1" async></script><a class="article-share-link" data-url="http://www.luo01.cn/2019/03/14/Vue Cli 中添加 Karma 执行样式相关的单元测试/" data-id="cjtbk92780000mguyna8noxbp" data-qrcode="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAPYAAAD2CAAAAADAeSUUAAADIElEQVR42u3aQY7jMAwEwPn/p7MPGMTuFjWLWCmfBkHWdikHLpv8+Ymv169r7ZvJHfJv5ndbvLCxsbEfwn5dXu8e8O7v/JP5fa7f8+anwsbGxj6OvfZC+UEkn+ek/D3ffo6NjY399eykqOwtjddPwcbGxsaes9uIJ28z1o4GGxsb+9vY7WOS4rErimqPY3OWho2Njf3x7LbYfPLffzLfxsbGxv5g9qu82mLWNhL5CGFyYWNjY5/EzgtAewRtFNWWzLaAYWNjY5/NbpGTUKltKpKVnRyJjY2NfR57EqPnI9V8EJu/yWjwjI2NjX0QO1+XaVP3dpCcH19bjaNfHhsbG/ux7PY/93mgf93GTDBrRRcbGxv7e9jFoLQse5N1ycVsLK+02NjY2A9nz9uA/KXX4v48nIpc2NjY2Aexc8C8jLX3yUcOebuCjY2NfR47WbtpH9Pi87vl34nqNjY2NvYR7PlgdV72cmTbhNQrO9jY2NiPZbdrNJMgaVdElbQ3NweKjY2NfQR7EuKvPb4d8W4YALz7nbGxsbEPYudhfY5p24O1liYvdW+zNGxsbOwj2JM2oC0ha6WxHRJEM21sbGzsI9iThmQ+DJiESkm7chNjYWNjYx/KnoT186Ky1nKsLRVhY2Njn8Fub7FrlLuW0rcNz00Tgo2NjX0Ee63NSI5jHicl+NxyM+7FxsbGfiw7aS3yRcy2sK21N3modDMVwcbGxj6CPX+hpEmYLNmsxUb5z4CNjY19HjsvXXnk9BfDhrZoYWNjY5/Nnqzp5GF9DmsLYfsdbGxs7G9gt0s8eRiUDwzap7TvgI2NjX0ee0M3U45s8xK4Ngy++TmxsbGxD2Xn1Hb4er1GM2lRFoMwbGxs7CPYr/La25zk5er6zvmSEDY2NvZ57LYA1AsxcQGb/Kv8zjUeGxsb+yHstWWa/Jh2RUXt0WNjY2N/G3tectYWdyYBU3v02NjY2NhtfL8W8eeltD1KbGxsbOz5IDYZPLQDiTyQwsbGxj6bnZSNtRe6fvxkYeg/ZWnY2NjYH8/OA5pdpatdtVlb1tmwuIONjY396ex/GgxKFaiEVcUAAAAASUVORK5CYII=">分享</a><div class="tags"><a href="/tags/vue/">vue</a></div><div class="post-nav"><a class="next" href="/2018/10/25/添加本地jar添加到本地maven仓库/">添加本地jar添加到本地 maven 仓库</a></div></div><script type="text/javascript" src="/js/artical.js?v=0.0.1"></script></div></div><div class="pure-u-1-4 hidden_mid_and_down"><div id="sidebar"><div class="widget"><a href="http://luo01.cn/"><img class="protrait" src="http://luo01.cn/img/protrait.png" alt=""/></a></div><div class="widget"><div class="search-form"><input id="local-search-input" placeholder="Search" type="text" name="q" results="0"/><div id="local-search-result"></div></div></div><div class="widget"><div class="widget-title"><i class="fa fa-folder-o"> 分类</i></div><ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/">Web前端</a><span class="category-list-count">16</span><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Hexo/">Hexo</a><span class="category-list-count">1</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Javascript/">Javascript</a><span class="category-list-count">3</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/Vue/">Vue</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/git/">git</a><span class="category-list-count">2</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/小程序/">小程序</a><span class="category-list-count">6</span></li><li class="category-list-item"><a class="category-list-link" href="/categories/Web前端/构建工具/">构建工具</a><span class="category-list-count">2</span></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/技巧篇/">技巧篇</a><span class="category-list-count">2</span></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-star-o"> 标签</i></div><div class="tagcloud"><a href="/tags/web/" style="font-size: 15px;">web</a> <a href="/tags/Async-Await-Js/" style="font-size: 15px;">Async/Await Js</a> <a href="/tags/设计模式-Js/" style="font-size: 15px;">设计模式 Js</a> <a href="/tags/git/" style="font-size: 15px;">git</a> <a href="/tags/vue/" style="font-size: 15px;">vue</a> <a href="/tags/web-小程序/" style="font-size: 15px;">web 小程序</a> <a href="/tags/web-自动化-构建工具/" style="font-size: 15px;">web 自动化 构建工具</a> <a href="/tags/Oracle/" style="font-size: 15px;">Oracle</a> <a href="/tags/maven/" style="font-size: 15px;">maven</a></div></div><div class="widget"><div class="widget-title"><i class="fa fa-file-o"> 最近文章</i></div><ul class="post-list"><li class="post-list-item"><a class="post-list-link" href="/2019/03/14/Vue Cli 中添加 Karma 执行样式相关的单元测试/">Vue Cli 中添加 Karma 执行样式相关的单元测试</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/25/添加本地jar添加到本地maven仓库/">添加本地jar添加到本地 maven 仓库</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/10/25/Oracle-回滚已提交的数据/">Oracle-回滚已提交的数据</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/29/小程序swiper-bindChange重复执行/">小程序swiper bindChange重复执行</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/15/gulp常用插件/">gulp常用插件</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/13/gulp详细入门教程/">gulp详细入门教程</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序如何引入fontAwesome/">小程序如何引入fontAwesome</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序实现左滑删除功能/">小程序实现左滑删除功能</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序封装滚动Tab选项卡-可滑动/">小程序封装滚动Tab选项卡: 可滑动</a></li><li class="post-list-item"><a class="post-list-link" href="/2018/09/08/小程序出现【需要身份验证】弹窗解决办法/">小程序出现【需要身份验证】弹窗解决办法</a></li></ul></div><div class="widget"><div class="widget-title"><i class="fa fa-external-link"> 友情链接</i></div><ul class="post-list"> <li class="post-list-item"> <a class="post-list-link" href="http://www.ruanyifeng.com" title="阮一峰" target="_blank">阮一峰</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.zhangxinxu.com/wordpress/" title="张鑫旭" target="_blank">张鑫旭</a></li><li class="post-list-item"> <a class="post-list-link" href="https://coolshell.cn/featured" title="左耳朵耗子" target="_blank">左耳朵耗子</a></li><li class="post-list-item"> <a class="post-list-link" href="http://www.giscafer.com/" title="Nickbing Lao" target="_blank">Nickbing Lao</a></li><li class="post-list-item"> <a class="post-list-link" href="https://ioliu.cn/" title="云淡风轻" target="_blank">云淡风轻</a></li><li class="post-list-item"> <a class="post-list-link" href="https://www.haomwei.com/" title="紫禁屠夫" target="_blank">紫禁屠夫</a></li></ul></div></div></div><div class="pure-u-1 pure-u-md-3-4"><div id="footer">Copyright © 2019 <a href="/." rel="nofollow">静默如初.</a> Powered by<a rel="nofollow" target="_blank" href="https://hexo.io"> Hexo.</a><a rel="nofollow" target="_blank" href="https://github.com/tufu9441/maupassant-hexo"> Theme</a> by<a rel="nofollow" target="_blank" href="https://github.com/pagecho"> Cho.</a></div></div></div><a class="show" id="rocket" href="#top"></a><script type="text/javascript" src="/js/totop.js?v=0.0.1" async></script><script type="text/javascript" src="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.js" async></script><script type="text/javascript" src="/js/fancybox.js?v=0.0.1" async></script><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/3.2.5/jquery.fancybox.min.css"><script type="text/javascript" src="/js/search.js?v=0.0.1"></script><script>var search_path = 'search.xml';
if (search_path.length == 0) {
   search_path = 'search.xml';
}
var path = '/' + search_path;
searchFunc(path, 'local-search-input', 'local-search-result');
</script><script type="text/javascript" src="/js/codeblock-resizer.js?v=0.0.1"></script><script type="text/javascript" src="/js/smartresize.js?v=0.0.1"></script></div></body></html>